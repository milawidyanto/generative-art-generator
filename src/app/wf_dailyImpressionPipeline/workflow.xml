<workflow-app name="wf_updateImpressionPipeline" xmlns="uri:oozie:workflow:0.5" xmlns:sla="uri:oozie:sla:0.2">

  <start to="updateIngestionTables" />

  <action name="updateIngestionTables">
    <sub-workflow>
      <app-path>${ingestion_wf_folder}
      </app-path>
      <propagate-configuration/>
    </sub-workflow>
    <ok to="updateStagingTables"/>
    <error to="sendNonCriticalAlert"/>
  </action>

  <action name="updateStagingTables">
    <sub-workflow>
      <app-path>${staging_wf_folder}
      </app-path>
      <propagate-configuration/>
    </sub-workflow>
    <ok to="updateCoreTables"/>
    <error to="sendNonCriticalAlert"/>
  </action>

  <action name="updateCoreTables">
    <sub-workflow>
      <app-path>${core_wf_folder}
      </app-path>
      <propagate-configuration/>
    </sub-workflow>
    <ok to="end"/>
    <error to="sendNonCriticalAlert"/>
  </action>  
  
  <action name="sendNonCriticalAlert">
        <sub-workflow>
            <app-path>${nameNode}/user/BI/hadoop-wf/co_genericTools/wf_sendNotification</app-path>
            <propagate-configuration/>
            <configuration>
                <property>
                    <name>emailRecipient</name>
                    <value>${error_notification_email_recipient}</value>
                </property>
                <property>
                    <name>slackChannel</name>
                    <value>${notification_slack_channel}</value>
                </property>
                <property>
                    <name>workflowName</name>
                    <value>${wf:name()}</value>
                </property>
                <property>
                    <name>workflowId</name>
                    <value>${wf:id()}</value>
                </property>
            </configuration>
        </sub-workflow>
        <ok to="kill" />
        <error to="kill" />
    </action>

  <kill name="kill">
    <message>Action failed, error
      message[${wf:errorMessage(wf:lastErrorNode())}]</message>
  </kill>
  <end name="end" /> 
</workflow-app>
