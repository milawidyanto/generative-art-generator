<coordinator-app name="${user}-${project}"
                 frequency="15 0 * * *" 
                 start="${coord_start_date}T00:10Z" 
                 end="2100-01-01T00:00Z"
                 timezone="UTC" 
                 xmlns="uri:oozie:coordinator:0.2"> 
  <datasets>
    <dataset name="wf_sessionStatsMaster_finished" 
             frequency="${coord:days(1)}"
             initial-instance="${dataset_start_date}" 
             timezone="UTC">
      <uri-template>${nameNode}/user/BI/trivago_analytic_prod/session_stats_master/ymd=${YEAR}${MONTH}${DAY}/_SUCCESS</uri-template>
      <done-flag></done-flag>
    </dataset>
    <dataset name="import_mpe_auction_optimization_results_finished" 
             frequency="${coord:days(1)}"
             initial-instance="${dataset_start_date}" 
             timezone="UTC">
      <uri-template>${nameNode}/user/kafka/data/auditor/success/mpe_auction_optimization_results_proto/${YEAR}${MONTH}${DAY}/_SUCCESS</uri-template>
      <done-flag></done-flag>
    </dataset>
    <dataset name="wf_trivago_stage_mpe_ea_optimization_results_finished" 
             frequency="${coord:days(1)}"
             initial-instance="${dataset_start_date}"
             timezone="UTC">
      <uri-template>${nameNode}/user/BI/data/trivago_stage/mpe_ea_optimization_results/ymd=${YEAR}${MONTH}${DAY}/_SUCCESS</uri-template>
      <done-flag></done-flag>
    </dataset>
  </datasets>
  <input-events>
    <data-in name="wf_sessionStatsMaster_finished" 
             dataset="wf_sessionStatsMaster_finished">
      <instance>${coord:current(-1)}</instance>
    </data-in>
    <data-in name="import_mpe_auction_optimization_results_finished" 
             dataset="import_mpe_auction_optimization_results_finished">
      <instance>${coord:current(-1)}</instance>
    </data-in>
    <data-in name="wf_trivago_stage_mpe_ea_optimization_results_finished" 
             dataset="wf_trivago_stage_mpe_ea_optimization_results_finished">
      <instance>${coord:current(-1)}</instance>
    </data-in>    
  </input-events>
  <action>
    <workflow>
      <app-path>${wf_folder}</app-path>
      <configuration>
        <property>
          <name>oozie.use.system.libpath</name>
          <value>True</value>
        </property>
        <property>
          <name>crunchDate</name>
          <value>${coord:formatTime(coord:dateOffset(coord:nominalTime(),-12,'HOUR'),'yyyyMMdd')}
          </value>
        </property>
        <property>
          <name>nominaltime</name>
          <value>${coord:nominalTime()}</value>
        </property>
        <property>
          <name>actual_time</name>
          <value>${coord:actualTime()}</value>
        </property>
        <property>
          <name>gobblin_streams_db</name>
          <value>${gobblin_streams_db}</value>
        </property>
        <property>
          <name>trivago_stage_db</name>
          <value>${trivago_stage_db}</value>
        </property>
        <property>
          <name>trivago_analytic_db</name>
          <value>${trivago_analytic_db}</value>
        </property> 
        <property>
          <name>trivago_stage_db_hdfs_path</name>
          <value>${trivago_stage_db_hdfs_path}</value>
        </property>
        <property>
          <name>trivago_analytic_db_hdfs_path</name>
          <value>${trivago_analytic_db_hdfs_path}</value>
        </property>  
        <property>
          <name>ingestion_wf_folder</name>
          <value>${ingestion_wf_folder}</value>
        </property>    
        <property>
          <name>staging_wf_folder</name>
          <value>${staging_wf_folder}</value>
        </property>   
        <property>
          <name>core_wf_folder</name>
          <value>${core_wf_folder}</value>
        </property>   
        <property>
          <name>success_notification_email_recipient</name>
          <value>${success_notification_email_recipient}</value>
        </property>
        <property>
          <name>error_notification_email_recipient</name>
          <value>${error_notification_email_recipient}</value>
        </property>             
        <property>
          <name>notification_slack_channel</name>
          <value>${notification_slack_channel}</value>
        </property>  
      </configuration>
    </workflow>
  </action>
</coordinator-app>
