#!/usr/bin/env python3

import sys

import click
import yaml

from trv.scaffolding.conf import get_project_conf
from trv.scaffolding.exceptions import ConfError


@click.command()
@click.option(
    "--project-file",
    default="pyproject.toml",
    help="Path of the configuration file (default: pyproject.toml)",
)
@click.option("--key", "-k", help="Display the value for this particular key")
def get_properties(project_file, key):
    """Display the configuration for the current project."""
    # read configuration
    try:
        project_conf = get_project_conf(project_file)
    except ConfError as err:
        click.echo(f"Configuration error: {err}", err=True)
        sys.exit(1)

    # display result
    if key:
        # one key
        try:
            value = project_conf[key]
        except KeyError:
            click.echo(f"Error: key {key} not found.", err=True)
            sys.exit(1)
        else:
            click.echo(value)
    else:
        print(yaml.dump(project_conf))


if __name__ == "__main__":
    get_properties()
