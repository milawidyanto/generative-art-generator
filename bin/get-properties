#!/usr/bin/env python3

import sys

import click

from lib.kerberos import get_kerberos_principal
from lib.oozie import read_user_properties
from app.directories import conf_dir


@click.command()
@click.option("--key", "-k", help="Display the value for this particular key")
def get_properties(key):
    """Display the computed properties for the current Kerberos user."""
    # get properties
    try:
        principal = get_kerberos_principal()
        properties = read_user_properties(conf_dir, principal)
    except Exception as err:
        click.echo(f"Error: {err}", err=True)
        sys.exit(1)

    # display result
    if key:
        # one key
        try:
            value = properties[key]
        except KeyError:
            click.echo(f"Error: key {key} not found.", err=True)
            sys.exit(1)
        else:
            click.echo(value)
    else:
        # all keys
        for key, value in properties.items():
            click.echo(f"{key}={value}")


if __name__ == "__main__":
    get_properties()
